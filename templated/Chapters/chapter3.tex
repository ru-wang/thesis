\chapter{基于增量式舒尔补的集束调整框架}\label{ch:ba}

本章将详细介绍基于增量式舒尔补的集束调整框架。首先第~\ref{sec:framework}~节中简要介绍该框架的设计和内置提供的目标函数；在第~\ref{sec:ischur}~节中介绍基于因子图的增量式舒尔补构建方法；在第~\ref{sec:lin_solver}~节中，针对ICE-BA、SLAM++算法中常见的舒尔补矩阵秩亏的问题，介绍本文提出的HLMDL算法，在不破坏舒尔补构建的增量特性的前提下增强线性解的数值稳定性。然后将介绍本文提出的基于贝叶斯推断树的PBT回代算法，以及如何使用PBT回代算法进行增量回代求解，并保证变量的一致性；第~\ref{sec:comp}~节将总结本文提出的增量式框架与其他增量式算法之间的区别。

\input{Chapters/framework.tex}

\input{Chapters/ischur_update.tex}

\input{Chapters/linear_solver.tex}

\section{增量式集束调整方法对比}\label{sec:comp}

一般来说，使用一个一般的求解器求解集束调整问题的流程可以包含如下步骤（如图~\ref{fig:pipeline}）：
\begin{enumerate}
    \item 用户通过调用相应的接口构建集束调整问题（因子图）；
    \item 首先求解器对问题进行线性化或同时计算鲁棒函数，随后不同求解器根据不同的策略先对变量进行分组或排序，或进行预消元（计算舒尔补）；
    \item 然后求解器依次进行线性求解和线性化点更新，并判断是否继续迭代，循环这一过程直到收敛。更进一步地，当问题（因子图）中增加了新的目标函数或变量时，对相关的数据结构进行增广。
\end{enumerate}

\begin{figure}[htb!]
    \centering
    \includegraphics[scale=.5]{Pictures/framework.png}
    \caption{通用集束调整框架求解流程}
    \label{fig:pipeline}
\end{figure}

本文实现的集束调整框架同样符合上述流程，区别在于该框架几乎任意一个部分均可自定义实现，也可以采用内置的算法，具有很好的通用性和扩展性。表~\ref{tab:comp}展示了本文提出的增量式集束调整框架和其他增量式优化算法的对比，并用粗体表示非增量求解的部分。需要注意的是，只有所有模块均符合增量操作的求解器才是完全增量的算法。而I-PCG仅仅是提高了收敛效率而没有降低时间复杂度，因此和Cholesky分解法一样，不属于增量操作。

{
\linespread{1}
\begin{table}[H]
\zihao{6}
\caption{增量式集束调整求解器对比：加粗显示了非增量操作的部分}
\label{tab:comp}
\centering
\begin{tabular}{l|p{.2\textwidth} p{.2\textwidth} p{.2\textwidth} p{.2\textwidth}}
    \toprule
    求解器     & 本文提出的框架
               & ICE-BA
               & SLAM++
               & iSAM2
               \\ \midrule
    非线性部分 & a）三维点和相机状态分别成组
               & a）三维点和相机状态分别成组
               & a）三维点和相机状态分别成组
               & a）使用CCOLAMD对变量进行排序
               \\
               & b）根据构建舒尔补构建PBT
               &
               & b）相机部分使用COLAMD排序
               & b）通过消元构建贝叶斯推断树
               \\ \midrule
    线性化     & a）部分线性化
               & a）部分线性化
               & a）部分线性化
               & a）根据贝叶斯推断树进行即时线性化
               \\
               & b）根据脏子图增量更新舒尔补
               & b）根据脏变量更新舒尔补
               & b）根据脏变量更新舒尔补
               & b）更新平方根信息矩阵
               \\ \midrule
    线性求解   & a）\textbf{Cholesy分解或增量I-PCG求解舒尔补方程}
               & a）\textbf{I-PCG求解舒尔补方程}
               & a）\textbf{Cholesky分解求解舒尔补方程}
               & a）求解贝叶斯推断树根节点变量
               \\
               & b）根据PBT增量回代求解三维点
               & b）\textbf{完整回代求解三维点}
               & b）\textbf{完整回代求解三维点}
               & b）根据贝叶斯推断树增量回代求解剩余变量
               \\ \midrule
    变量更新   & 标记脏变量
               & 标记脏变量
               & 标记脏变量
               & 标记脏变量
               \\
    \bottomrule
\end{tabular}
\end{table}
}

\section{本章小结}

本章详细介绍了基于增量式舒尔补的集束调整框架，包括框架的设计和内置提供的目标函数、基于因子图的增量式舒尔补构建方法、HLMDL算法和PBT回代算法，并对比了本文提出的增量式框架与其他增量式算法之间的区别。一组增量式集束调整优化的流程总结如下：
\begin{enumerate}
    \item 根据因子图，采用传统方法构建舒尔补并使用Cholesky分解或PCG方法求解首轮迭代，并构建PBT；
    \item\label{it:2} 使用算法~\ref{alg:mark_dirty}标记因子图和舒尔补方程需要更新的部分；
    \item\label{it:3} 使用算法~\ref{alg:schur_update}更新舒尔补；
    \item\label{it:4} 使用Cholesky分解或I-PCG方法求解舒尔补方程；
    \item\label{it:5} 基于PBT推断进行回代求解三维点状态；
    \item 重复步骤~\ref{it:2}至步骤~\ref{it:5}直到收敛；
    \item 当新增了因子或状态时，使用算法~\ref{alg:factor_graph_aug}进行增广，并重新从步骤~\ref{it:2}开始新一组优化。
\end{enumerate}
